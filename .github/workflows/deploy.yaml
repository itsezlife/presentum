name: Deploy to Pub.dev

on:
  workflow_dispatch:
  push:
    tags:
      - "[0-9]+.[0-9]+.[0-9]+*"

jobs:
  deploy:
    name: "Deploy to Pub.dev"
    permissions:
      id-token: write # Required for authentication using OIDC
    runs-on: ubuntu-latest
    steps:
      # Checkout repository
      - name: ğŸš‚ Get latest code
        uses: actions/checkout@v6

      - name: ğŸ“± Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: "3.24.x"
          channel: "stable"
          cache: true

      - name: ğŸ‘· Get dependencies
        run: |
          flutter pub get
        timeout-minutes: 5

      - name: ğŸ—ï¸ Publish - dry run
        run: flutter pub publish --dry-run
        timeout-minutes: 5

      - name: ğŸ”¥ Publish to pub.dev
        run: yes | flutter pub publish -f --skip-validation
        timeout-minutes: 5
